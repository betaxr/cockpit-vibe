import { useMemo } from "react";

interface AgentSilhouetteProps {
  /** Utilization percentage 0-100 */
  utilization: number;
  /** Height of the silhouette in pixels */
  height?: number;
  /** Primary color for the filled portion */
  fillColor?: string;
  /** Background/unfilled color */
  bgColor?: string;
  className?: string;
}

/**
 * Agent silhouette that acts as a vertical bar chart.
 * The fill level represents utilization/data percentage.
 */
export default function AgentSilhouette({
  utilization,
  height = 400,
  fillColor = "oklch(0.65 0.18 45)",
  bgColor = "oklch(0.35 0.08 45 / 50%)",
  className = "",
}: AgentSilhouetteProps) {
  // Clamp utilization between 0 and 100
  const clampedUtilization = Math.max(0, Math.min(100, utilization));
  
  // Calculate the gradient stop position (inverted because SVG y-axis is top-down)
  const fillPercentage = 100 - clampedUtilization;
  
  // Generate unique ID for this instance's gradient
  const gradientId = useMemo(() => `silhouette-gradient-${Math.random().toString(36).slice(2)}`, []);
  const maskId = useMemo(() => `silhouette-mask-${Math.random().toString(36).slice(2)}`, []);

  // Calculate aspect ratio based on original SVG (133 x 535)
  const aspectRatio = 133 / 535;
  const width = height * aspectRatio;

  return (
    <div className={`relative ${className}`} style={{ width, height }}>
      <svg 
        width={width} 
        height={height} 
        viewBox="0 0 133 535" 
        fill="none" 
        xmlns="http://www.w3.org/2000/svg"
        className="drop-shadow-lg"
      >
        <defs>
          {/* Gradient for the fill effect */}
          <linearGradient id={gradientId} x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset={`${fillPercentage}%`} stopColor={bgColor} />
            <stop offset={`${fillPercentage}%`} stopColor={fillColor} />
            <stop offset="100%" stopColor={fillColor} />
          </linearGradient>
          
          {/* Mask using the silhouette shape */}
          <mask id={maskId}>
            <path 
              d="M132.991 267.316L129.653 197.063C129.624 196.632 129.535 196.207 129.389 195.8C129.487 195.26 129.503 194.708 129.439 194.163L119.796 101.561C119.38 98.1729 115.949 95.781 112.172 96.2456L86.0878 91.6625C83.1895 89.0513 79.7974 87.0471 76.1119 85.7682L76.2582 77.9099C81.8048 75.9509 86.6312 72.3639 90.1063 67.6179C93.5815 62.8718 95.5436 57.1876 95.7362 51.3084H95.7577V29.1131C95.7353 21.3989 92.661 14.007 87.2063 8.55214C81.7516 3.09726 74.3598 0.0226818 66.6456 0C58.9314 0.0226805 51.5395 3.09723 46.0847 8.55208C40.6298 14.0069 37.5553 21.3988 37.5326 29.1131V51.3084H37.5551C37.7478 57.1876 39.7102 62.8717 43.1855 67.6176C46.6609 72.3635 51.4874 75.9503 57.0341 77.9088L57.1804 85.7672C53.4947 87.0467 50.1027 89.0516 47.2045 91.6635L20.8272 96.2467C17.0516 95.783 13.6208 98.1749 13.2043 101.562L3.56099 194.165C3.49647 194.71 3.51303 195.262 3.61012 195.802C3.46381 196.209 3.37493 196.634 3.34606 197.065L0.00847176 267.316C-0.0659639 268.556 0.35242 269.775 1.1725 270.707C1.99259 271.64 3.14795 272.211 4.38695 272.296L6.72562 272.445C7.96557 272.521 9.18534 272.104 10.1184 271.284C11.0514 270.463 11.6218 269.307 11.7049 268.068L20.0616 198.634C20.0688 198.518 20.0678 198.403 20.0616 198.287C20.4004 197.673 29.7459 132.66 29.7459 132.66V143.221C29.7503 145.624 30.3417 147.99 31.4689 150.113C32.596 152.235 34.2247 154.05 36.2133 155.4L46.9794 204.855C41.1803 210.186 22.3563 237.846 22.3563 247.21V263.56C22.3563 263.955 22.3717 264.347 22.3942 264.737C22.3657 264.979 22.3538 265.222 22.3584 265.465L28.7122 390.439C28.7234 390.924 28.6866 393.565 28.7572 394.458L41.5354 526.277C41.7496 528.627 42.8829 530.797 44.6888 532.315C46.4947 533.833 48.8272 534.577 51.1787 534.385L55.6493 534.039C57.9991 533.87 60.1859 532.776 61.7302 530.997C63.2746 529.218 64.0503 526.899 63.8874 524.549L60.8415 393.062C61.4757 392.104 61.8071 390.978 61.7923 389.83L62.0144 283.635H70.3804L70.6014 389.83C70.5864 390.978 70.9177 392.105 71.5523 393.062L68.5074 524.546C68.3444 526.896 69.1202 529.215 70.6645 530.994C72.2088 532.773 74.3957 533.867 76.7454 534.036L81.216 534.382C83.5675 534.574 85.8998 533.83 87.7056 532.312C89.5115 530.793 90.6449 528.623 90.8593 526.274L103.632 394.459C103.704 393.567 103.666 390.925 103.678 390.44L109.889 268.284C110.266 266.738 110.457 265.152 110.458 263.561V247.212C110.458 238.015 92.1069 210.187 86.3038 204.857L97.0698 155.402C99.0583 154.052 100.687 152.237 101.814 150.115C102.941 147.992 103.532 145.626 103.536 143.223V134.721C103.536 134.721 112.591 197.674 112.929 198.288C112.929 198.404 112.929 198.519 112.929 198.635L121.284 268.069C121.368 269.308 121.938 270.464 122.871 271.284C123.804 272.104 125.024 272.522 126.264 272.446L128.603 272.297C129.845 272.216 131.004 271.646 131.826 270.713C132.648 269.779 133.067 268.558 132.991 267.316Z" 
              fill="white"
            />
          </mask>
        </defs>
        
        {/* Background silhouette (unfilled) */}
        <rect 
          x="0" 
          y="0" 
          width="133" 
          height="535" 
          fill={`url(#${gradientId})`}
          mask={`url(#${maskId})`}
        />
        
        {/* Outline for definition */}
        <path 
          d="M132.991 267.316L129.653 197.063C129.624 196.632 129.535 196.207 129.389 195.8C129.487 195.26 129.503 194.708 129.439 194.163L119.796 101.561C119.38 98.1729 115.949 95.781 112.172 96.2456L86.0878 91.6625C83.1895 89.0513 79.7974 87.0471 76.1119 85.7682L76.2582 77.9099C81.8048 75.9509 86.6312 72.3639 90.1063 67.6179C93.5815 62.8718 95.5436 57.1876 95.7362 51.3084H95.7577V29.1131C95.7353 21.3989 92.661 14.007 87.2063 8.55214C81.7516 3.09726 74.3598 0.0226818 66.6456 0C58.9314 0.0226805 51.5395 3.09723 46.0847 8.55208C40.6298 14.0069 37.5553 21.3988 37.5326 29.1131V51.3084H37.5551C37.7478 57.1876 39.7102 62.8717 43.1855 67.6176C46.6609 72.3635 51.4874 75.9503 57.0341 77.9088L57.1804 85.7672C53.4947 87.0467 50.1027 89.0516 47.2045 91.6635L20.8272 96.2467C17.0516 95.783 13.6208 98.1749 13.2043 101.562L3.56099 194.165C3.49647 194.71 3.51303 195.262 3.61012 195.802C3.46381 196.209 3.37493 196.634 3.34606 197.065L0.00847176 267.316C-0.0659639 268.556 0.35242 269.775 1.1725 270.707C1.99259 271.64 3.14795 272.211 4.38695 272.296L6.72562 272.445C7.96557 272.521 9.18534 272.104 10.1184 271.284C11.0514 270.463 11.6218 269.307 11.7049 268.068L20.0616 198.634C20.0688 198.518 20.0678 198.403 20.0616 198.287C20.4004 197.673 29.7459 132.66 29.7459 132.66V143.221C29.7503 145.624 30.3417 147.99 31.4689 150.113C32.596 152.235 34.2247 154.05 36.2133 155.4L46.9794 204.855C41.1803 210.186 22.3563 237.846 22.3563 247.21V263.56C22.3563 263.955 22.3717 264.347 22.3942 264.737C22.3657 264.979 22.3538 265.222 22.3584 265.465L28.7122 390.439C28.7234 390.924 28.6866 393.565 28.7572 394.458L41.5354 526.277C41.7496 528.627 42.8829 530.797 44.6888 532.315C46.4947 533.833 48.8272 534.577 51.1787 534.385L55.6493 534.039C57.9991 533.87 60.1859 532.776 61.7302 530.997C63.2746 529.218 64.0503 526.899 63.8874 524.549L60.8415 393.062C61.4757 392.104 61.8071 390.978 61.7923 389.83L62.0144 283.635H70.3804L70.6014 389.83C70.5864 390.978 70.9177 392.105 71.5523 393.062L68.5074 524.546C68.3444 526.896 69.1202 529.215 70.6645 530.994C72.2088 532.773 74.3957 533.867 76.7454 534.036L81.216 534.382C83.5675 534.574 85.8998 533.83 87.7056 532.312C89.5115 530.793 90.6449 528.623 90.8593 526.274L103.632 394.459C103.704 393.567 103.666 390.925 103.678 390.44L109.889 268.284C110.266 266.738 110.457 265.152 110.458 263.561V247.212C110.458 238.015 92.1069 210.187 86.3038 204.857L97.0698 155.402C99.0583 154.052 100.687 152.237 101.814 150.115C102.941 147.992 103.532 145.626 103.536 143.223V134.721C103.536 134.721 112.591 197.674 112.929 198.288C112.929 198.404 112.929 198.519 112.929 198.635L121.284 268.069C121.368 269.308 121.938 270.464 122.871 271.284C123.804 272.104 125.024 272.522 126.264 272.446L128.603 272.297C129.845 272.216 131.004 271.646 131.826 270.713C132.648 269.779 133.067 268.558 132.991 267.316Z" 
          fill="none"
          stroke="oklch(0.55 0.15 45 / 60%)"
          strokeWidth="1.5"
        />
      </svg>
      

    </div>
  );
}
